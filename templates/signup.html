<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Funza Mama</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.jpg') }}" type="image/x-icon"> 
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'warm-pink': '#F8BBD9',
                        'soft-purple': '#E8C5E8',
                        'deep-rose': '#D63384',
                        'warm-mauve': '#C77DFF',
                        'soft-cream': '#FFF8F0',
                        'warm-gray': '#F5F5F5',
                        'deep-plum': '#6B46C1',
                        'warm-brown': '#8B4513'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #F8BBD9 0%, #E8C5E8 50%, #FFF8F0 100%);
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-input {
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        /* Error message styling */
        .error-message {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideDown 0.3s ease-out;
        }
        
        .error-message::before {
            content: "⚠️";
            font-size: 0.875rem;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Input error state */
        .form-input.border-red-500:focus {
            border-color: #ef4444;
            ring-color: #ef4444;
        }
        
        /* Password toggle button styling */
        .password-toggle-btn {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: #6b7280;
            transition: color 0.2s ease;
        }
        
        .password-toggle-btn:hover {
            color: #6B46C1;
        }
        
        .password-toggle-btn:focus {
            outline: 2px solid #D63384;
            outline-offset: 2px;
            border-radius: 0.25rem;
        }

.avatar-option {
            transition: all 0.3s ease;
}

.avatar-option:hover {
            transform: scale(1.05);
        }
        
        .avatar-option.selected {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        /* Avatar animations */
        .avatar-container {
            animation: avatarBreathe 3s ease-in-out infinite;
        }

        .avatar-eyes .animate-blink {
            animation: avatarBlink 4s ease-in-out infinite;
        }

        .avatar-smile {
            animation: avatarSmile 2s ease-in-out infinite;
        }

        @keyframes avatarBreathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes avatarBlink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        @keyframes avatarSmile {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(1.1); }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg font-inter">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <img src="{{ url_for('static', filename='images/favicon.jpg') }}" alt="Funza Mama" class="h-12 w-12 rounded-full object-cover">
                    <span class="text-2xl font-bold text-deep-plum font-poppins">Funza Mama</span>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="{{ url_for('home.home') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                    <a href="{{ url_for('login.login') }}" class="bg-deep-plum text-white px-4 py-2 rounded-full hover:bg-deep-rose transition-all font-medium">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-deep-plum hover:text-deep-rose focus:outline-none">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t border-gray-200 bg-white/95 backdrop-blur-sm">
                <div class="flex flex-col space-y-4 pt-4">
                    <a href="{{ url_for('home.home') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium px-4 py-2 rounded-lg hover:bg-warm-gray/50">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                    <a href="{{ url_for('login.login') }}" class="bg-deep-plum text-white px-6 py-3 rounded-full hover:bg-deep-rose transition-all font-medium text-center mx-4">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl w-full space-y-8">
            <!-- Signup Card -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8 fade-in">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-deep-rose to-warm-mauve rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-plus text-white text-3xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-deep-plum font-poppins mb-2">Join Funza Mama</h2>
                    <p class="text-warm-brown">Start your personalized maternal health learning journey</p>
                </div>

                <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                            <div class="mb-6 p-4 rounded-xl {% if category == 'success' %}bg-green-100 text-green-800{% elif category == 'error' %}bg-red-100 text-red-800{% elif category == 'warning' %}bg-yellow-100 text-yellow-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                                <div class="flex items-center justify-between">
                                    <span>{{ message }}</span>
                                    <button onclick="this.parentElement.parentElement.remove()" class="text-{{ 'green' if category == 'success' else 'red' if category == 'error' else 'yellow' if category == 'warning' else 'blue' }}-500 hover:text-{{ 'green' if category == 'success' else 'red' if category == 'error' else 'yellow' if category == 'warning' else 'blue' }}-700">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
                <!-- Signup Form -->
                <form method="POST" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="first_name" class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-user mr-2"></i>First Name
                            </label>
                            <input 
                                type="text" 
                                id="first_name" 
                                name="fname" 
                                required 
                                class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                                placeholder="Enter your first name"
                            >
                            <div id="first_name_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>

                        <div>
                            <label for="last_name" class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-user mr-2"></i>Last Name
                            </label>
                            <input 
                                type="text" 
                                id="last_name" 
                                name="lname" 
                                required 
                                value="{{ form_data.lname if form_data else '' }}"
                                class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                                placeholder="Enter your last name"
                            >
                            <div id="last_name_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-deep-plum mb-2">
                            <i class="fas fa-envelope mr-2"></i>Email Address
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            required 
                            value="{{ form_data.email if form_data else '' }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                            placeholder="Enter your email"
                        >
                        <div id="email_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                    </div>

                    <div>
                        <label for="username" class="block text-sm font-medium text-deep-plum mb-2">
                            <i class="fas fa-user mr-2"></i>Username
                        </label>
                        <input 
                            type="text" 
                            id="username" 
                            name="Uname" 
                            required 
                            value="{{ form_data.Uname if form_data else '' }}"
                            class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                            placeholder="Choose a username"
                        >
                        <div id="username_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="password" class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-lock mr-2"></i>Password
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="password" 
                                    name="password" 
                                    required 
                                    class="form-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                                    placeholder="Create a password"
                                >
                                <button 
                                    type="button"
                                    id="togglePassword"
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-deep-plum focus:outline-none transition-colors"
                                    onclick="togglePasswordVisibility('password', 'togglePassword')"
                                    aria-label="Toggle password visibility"
                                >
                                    <i class="fas fa-eye" id="togglePasswordIcon"></i>
                                </button>
                            </div>
                            <div id="password_strength" class="hidden"></div>
                            <div id="password_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>

                        <div>
                            <label for="confirm_password" class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-lock mr-2"></i>Confirm Password
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="confirm_password" 
                                    name="confirm_password" 
                                    required 
                                    class="form-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                                    placeholder="Confirm your password"
                                >
                                <button 
                                    type="button"
                                    id="toggleConfirmPassword"
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-deep-plum focus:outline-none transition-colors"
                                    onclick="togglePasswordVisibility('confirm_password', 'toggleConfirmPassword')"
                                    aria-label="Toggle password visibility"
                                >
                                    <i class="fas fa-eye" id="toggleConfirmPasswordIcon"></i>
                                </button>
                            </div>
                            <div id="confirm_password_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>
                    </div>

                    <!-- Demographics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="age" class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-calendar mr-2"></i>Age
                            </label>
                            <input 
                                type="number" 
                                id="age" 
                                name="age" 
                                required 
                                min="13" 
                                max="100"
                                value="{{ form_data.age if form_data else '' }}"
                                class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                                placeholder="Enter your age"
                            >
                            <div id="age_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>

                        <div>
                            <label for="gender" class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-venus-mars mr-2"></i>Gender
                            </label>
                            <select 
                                id="gender" 
                                name="gender" 
                                required 
                                class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-warm-gray/30"
                            >
                                <option value="">Select your gender</option>
                                <option value="female" {% if form_data and form_data.gender == 'female' %}selected{% endif %}>Female</option>
                                <option value="male" {% if form_data and form_data.gender == 'male' %}selected{% endif %}>Male</option>
                                <option value="other" {% if form_data and form_data.gender == 'other' %}selected{% endif %}>Other</option>
                                <option value="prefer_not_to_say" {% if form_data and form_data.gender == 'prefer_not_to_say' %}selected{% endif %}>Prefer not to say</option>
                            </select>
                            <div id="gender_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>
                    </div>

                    <!-- Avatar Selection -->
                    <div>
                        <label class="block text-sm font-medium text-deep-plum mb-4">
                            <i class="fas fa-user-circle mr-2"></i>Choose Your Avatar (Profile Picture)
                        </label>
                        
                        <!-- Upload Your Own Avatar -->
                        <div class="mb-4 p-4 bg-warm-gray/30 rounded-xl border-2 border-dashed border-deep-rose/50">
                            <label class="block text-sm font-medium text-deep-plum mb-2">
                                <i class="fas fa-upload mr-2"></i>Or Upload Your Own Picture
                            </label>
                            <input 
                                type="file" 
                                id="avatar_file" 
                                name="avatar_file" 
                                accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
                                class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-deep-rose focus:border-transparent bg-white text-sm"
                                onchange="previewAvatar(this)"
                            >
                            <p class="text-xs text-warm-brown mt-2">Accepted formats: PNG, JPG, JPEG, GIF, WEBP (Max 5MB)</p>
                            <div id="avatarPreview" class="mt-3 hidden">
                                <img id="avatarPreviewImg" src="" alt="Preview" class="w-20 h-20 rounded-full border-2 border-deep-rose mx-auto object-cover">
                            </div>
                        </div>
                        
                        <p class="text-xs text-warm-brown mb-4 text-center">OR select from predefined avatars below:</p>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="avatar-option cursor-pointer p-4 rounded-xl border-2 border-transparent hover:border-deep-rose bg-warm-gray/30" onclick="selectAvatar('images/avatars/diverse-1.png', this)">
                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-transparent">
                                    <div class="avatar-container w-full h-full rounded-full bg-gradient-to-br from-amber-200 to-orange-300 flex items-center justify-center">
                                        <div class="avatar-face w-12 h-12 rounded-full bg-gradient-to-br from-amber-100 to-orange-200 flex items-center justify-center">
                                            <div class="avatar-eyes flex space-x-1">
                                                <div class="w-1.5 h-1.5 bg-brown-800 rounded-full animate-blink"></div>
                                                <div class="w-1.5 h-1.5 bg-brown-800 rounded-full animate-blink" style="animation-delay: 0.1s"></div>
                                            </div>
                                            <div class="avatar-smile absolute bottom-2 w-4 h-2 border-2 border-brown-800 border-t-0 rounded-b-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-center text-deep-plum font-medium">Aisha</p>
                                <input type="radio" name="avatar" value="images/avatars/diverse-1.png" class="hidden">
                            </div>
                            
                            <div class="avatar-option cursor-pointer p-4 rounded-xl border-2 border-transparent hover:border-deep-rose bg-warm-gray/30" onclick="selectAvatar('images/avatars/diverse-2.png', this)">
                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-transparent">
                                    <div class="avatar-container w-full h-full rounded-full bg-gradient-to-br from-blue-200 to-indigo-300 flex items-center justify-center">
                                        <div class="avatar-face w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-indigo-200 flex items-center justify-center">
                                            <div class="avatar-eyes flex space-x-1">
                                                <div class="w-1.5 h-1.5 bg-blue-900 rounded-full animate-blink"></div>
                                                <div class="w-1.5 h-1.5 bg-blue-900 rounded-full animate-blink" style="animation-delay: 0.1s"></div>
                                            </div>
                                            <div class="avatar-smile absolute bottom-2 w-4 h-2 border-2 border-blue-900 border-t-0 rounded-b-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-center text-deep-plum font-medium">Marcus</p>
                                <input type="radio" name="avatar" value="images/avatars/diverse-2.png" class="hidden">
                            </div>
                            
                            <div class="avatar-option cursor-pointer p-4 rounded-xl border-2 border-transparent hover:border-deep-rose bg-warm-gray/30" onclick="selectAvatar('images/avatars/diverse-3.png', this)">
                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-transparent">
                                    <div class="avatar-container w-full h-full rounded-full bg-gradient-to-br from-green-200 to-emerald-300 flex items-center justify-center">
                                        <div class="avatar-face w-12 h-12 rounded-full bg-gradient-to-br from-green-100 to-emerald-200 flex items-center justify-center">
                                            <div class="avatar-eyes flex space-x-1">
                                                <div class="w-1.5 h-1.5 bg-green-900 rounded-full animate-blink"></div>
                                                <div class="w-1.5 h-1.5 bg-green-900 rounded-full animate-blink" style="animation-delay: 0.1s"></div>
                                            </div>
                                            <div class="avatar-smile absolute bottom-2 w-4 h-2 border-2 border-green-900 border-t-0 rounded-b-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-center text-deep-plum font-medium">Priya</p>
                                <input type="radio" name="avatar" value="images/avatars/diverse-3.png" class="hidden">
                            </div>
                            
                            <div class="avatar-option cursor-pointer p-4 rounded-xl border-2 border-transparent hover:border-deep-rose bg-warm-gray/30" onclick="selectAvatar('images/avatars/professional-1.png', this)">
                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-transparent">
                                    <div class="avatar-container w-full h-full rounded-full bg-gradient-to-br from-purple-200 to-violet-300 flex items-center justify-center">
                                        <div class="avatar-face w-12 h-12 rounded-full bg-gradient-to-br from-purple-100 to-violet-200 flex items-center justify-center relative">
                                            <div class="avatar-eyes flex space-x-1">
                                                <div class="w-1.5 h-1.5 bg-purple-900 rounded-full animate-blink"></div>
                                                <div class="w-1.5 h-1.5 bg-purple-900 rounded-full animate-blink" style="animation-delay: 0.1s"></div>
                                            </div>
                                            <div class="avatar-smile absolute bottom-2 w-4 h-2 border-2 border-purple-900 border-t-0 rounded-b-full"></div>
                                            <div class="avatar-glasses absolute top-1.5 w-8 h-3 border-2 border-purple-900 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-center text-deep-plum font-medium">Dr. Sarah</p>
                                <input type="radio" name="avatar" value="images/avatars/professional-1.png" class="hidden">
                            </div>
                            
                            <div class="avatar-option cursor-pointer p-4 rounded-xl border-2 border-transparent hover:border-deep-rose bg-warm-gray/30" onclick="selectAvatar('images/avatars/casual-1.png', this)">
                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-transparent">
                                    <div class="avatar-container w-full h-full rounded-full bg-gradient-to-br from-pink-200 to-rose-300 flex items-center justify-center">
                                        <div class="avatar-face w-12 h-12 rounded-full bg-gradient-to-br from-pink-100 to-rose-200 flex items-center justify-center">
                                            <div class="avatar-eyes flex space-x-1">
                                                <div class="w-1.5 h-1.5 bg-pink-900 rounded-full animate-blink"></div>
                                                <div class="w-1.5 h-1.5 bg-pink-900 rounded-full animate-blink" style="animation-delay: 0.1s"></div>
                                            </div>
                                            <div class="avatar-smile absolute bottom-2 w-4 h-2 border-2 border-pink-900 border-t-0 rounded-b-full"></div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-center text-deep-plum font-medium">Emma</p>
                                <input type="radio" name="avatar" value="images/avatars/casual-1.png" class="hidden">
                            </div>
                            
                            <div class="avatar-option cursor-pointer p-4 rounded-xl border-2 border-transparent hover:border-deep-rose bg-warm-gray/30" onclick="selectAvatar('images/avatars/diverse-4.png', this)">
                                <div class="w-16 h-16 mx-auto mb-2 rounded-full border-2 border-transparent">
                                    <div class="avatar-container w-full h-full rounded-full bg-gradient-to-br from-teal-200 to-cyan-300 flex items-center justify-center">
                                        <div class="avatar-face w-12 h-12 rounded-full bg-gradient-to-br from-teal-100 to-cyan-200 flex items-center justify-center">
                                            <div class="avatar-eyes flex space-x-1">
                                                <div class="w-1.5 h-1.5 bg-teal-900 rounded-full animate-blink"></div>
                                                <div class="w-1.5 h-1.5 bg-teal-900 rounded-full animate-blink" style="animation-delay: 0.1s"></div>
                                            </div>
                                            <div class="avatar-smile absolute bottom-2 w-4 h-2 border-2 border-teal-900 border-t-0 rounded-b-full"></div>
                                        </div>
                </div>
                    </div>
                                <p class="text-xs text-center text-deep-plum font-medium">Zara</p>
                                <input type="radio" name="avatar" value="images/avatars/diverse-4.png" class="hidden">
                    </div>
                    </div>
                </div>

                    <!-- Terms and Conditions -->
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            <input 
                                id="terms" 
                                name="terms" 
                                type="checkbox" 
                                required
                                class="h-4 w-4 text-deep-rose focus:ring-deep-rose border-gray-300 rounded"
                            >
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="terms" class="text-warm-brown">
                                I agree to the <a href="#" onclick="event.preventDefault(); showTermsModal(); return false;" class="text-deep-rose hover:text-deep-plum font-medium underline">Terms of Service</a> 
                                and <a href="#" onclick="event.preventDefault(); showPrivacyModal(); return false;" class="text-deep-rose hover:text-deep-plum font-medium underline">Privacy Policy</a>
                            </label>
                            <div id="terms_error" class="error-message hidden text-red-600 text-sm mt-1"></div>
                        </div>
            </div>

                    <button 
                        type="submit" 
                        id="submitBtn"
                        class="btn-primary w-full bg-gradient-to-r from-deep-rose to-warm-mauve text-white py-3 px-4 rounded-xl hover:from-warm-mauve hover:to-deep-rose font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                    >
                        <i class="fas fa-user-plus mr-2"></i>
                        <span id="submitBtnText">Create Account</span>
                    </button>
        </form>
        
                <!-- Divider -->
                <div class="mt-8">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-warm-brown">Already have an account?</span>
                        </div>
                    </div>
    </div>

                <!-- Login Link -->
                <div class="mt-6 text-center">
                    <a 
                        href="{{ url_for('login.login') }}" 
                        class="w-full bg-white text-deep-plum py-3 px-4 rounded-xl hover:bg-warm-gray transition-colors font-semibold border-2 border-deep-plum inline-block"
                    >
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Sign In Instead
                    </a>
                </div>

                <!-- Back to Home -->
                <div class="mt-4 text-center">
                    <a 
                        href="{{ url_for('home.home') }}" 
                        class="text-warm-brown hover:text-deep-plum transition-colors text-sm"
                    >
                        <i class="fas fa-arrow-left mr-1"></i>
                        Back to Home
                    </a>
                </div>
            </div>

            <!-- Features Preview -->
            <div class="bg-white/60 backdrop-blur-sm rounded-2xl p-6 fade-in">
                <h3 class="text-lg font-semibold text-deep-plum mb-4 text-center">What you'll get:</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex flex-col items-center space-y-2">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-graduation-cap text-white text-lg"></i>
                        </div>
                        <span class="text-warm-brown text-sm text-center">Interactive Learning</span>
                    </div>
                    <div class="flex flex-col items-center space-y-2">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-white text-lg"></i>
                        </div>
                        <span class="text-warm-brown text-sm text-center">AI Guidance</span>
                    </div>
                    <div class="flex flex-col items-center space-y-2">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-trophy text-white text-lg"></i>
                        </div>
                        <span class="text-warm-brown text-sm text-center">Progress Tracking</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white/60 backdrop-blur-sm py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-warm-brown font-medium">
                    <i class="fas fa-heart text-deep-rose mr-1"></i>
                    Empowering families through knowledge and play
                </p>
                <p class="text-warm-brown text-sm mt-2">© 2024 Funza Mama. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        function selectAvatar(avatarPath, element) {
            // Play click sound and vibrate
            playClickSound();
            vibrate([50]);
            
            // Clear file input if predefined avatar is selected
            const fileInput = document.getElementById('avatar_file');
            if (fileInput) {
                fileInput.value = '';
                const preview = document.getElementById('avatarPreview');
                if (preview) preview.classList.add('hidden');
            }
            
            // Remove selected class from all options
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
                option.classList.remove('bg-deep-rose/20');
                option.classList.add('bg-warm-gray/30');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            element.classList.remove('bg-warm-gray/30');
            element.classList.add('bg-deep-rose/20');
            
            // Check the radio button
            const radio = element.querySelector('input[type="radio"]');
            radio.checked = true;
        }
        
        function previewAvatar(input) {
            // Clear predefined avatar selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
                option.classList.remove('bg-deep-rose/20');
                option.classList.add('bg-warm-gray/30');
            });
            document.querySelectorAll('input[type="radio"][name="avatar"]').forEach(radio => {
                radio.checked = false;
            });
            
            // Show preview
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('avatarPreview');
                    const previewImg = document.getElementById('avatarPreviewImg');
                    if (preview && previewImg) {
                        previewImg.src = e.target.result;
                        preview.classList.remove('hidden');
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // Sound System for signup
        let soundEnabled = true;
        let audioContext = null;
        
        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Play sound function
        function playSound(frequency, duration, type = 'sine') {
            if (!soundEnabled) return;
            
            initAudio();
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playClickSound() {
            playSound(800, 0.1, 'square');
        }
        
        // Vibration
        function vibrate(pattern = [100]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }
        
        // Password visibility toggle (defined globally for onclick handlers)
        function togglePasswordVisibility(inputId, buttonId) {
            const passwordInput = document.getElementById(inputId);
            const toggleButton = document.getElementById(buttonId);
            const toggleIcon = document.getElementById(buttonId + 'Icon');
            
            if (passwordInput && toggleIcon) {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleIcon.classList.remove('fa-eye');
                    toggleIcon.classList.add('fa-eye-slash');
                    if (toggleButton) {
                        toggleButton.setAttribute('aria-label', 'Hide password');
                    }
                } else {
                    passwordInput.type = 'password';
                    toggleIcon.classList.remove('fa-eye-slash');
                    toggleIcon.classList.add('fa-eye');
                    if (toggleButton) {
                        toggleButton.setAttribute('aria-label', 'Show password');
                    }
                }
            }
        }

        // Form data persistence (preserve form data on page reload)
        function saveFormData() {
            const formData = {
                fname: document.getElementById('first_name')?.value || '',
                lname: document.getElementById('last_name')?.value || '',
                email: document.getElementById('email')?.value || '',
                username: document.getElementById('username')?.value || '',
                age: document.getElementById('age')?.value || '',
                gender: document.getElementById('gender')?.value || '',
                avatar: document.querySelector('input[name="avatar"]:checked')?.value || ''
            };
            // Don't save passwords for security
            sessionStorage.setItem('signup_form_data', JSON.stringify(formData));
        }
        
        function restoreFormData() {
            let serverFormData = null;
            
            // First, restore from server-side form_data (if available from backend)
            {% if form_data %}
            serverFormData = {
                fname: '{{ form_data.fname|safe }}',
                lname: '{{ form_data.lname|safe }}',
                email: '{{ form_data.email|safe }}',
                Uname: '{{ form_data.Uname|safe }}',
                age: '{{ form_data.age|safe }}',
                gender: '{{ form_data.gender|safe }}',
                avatar: '{{ form_data.avatar|safe }}'
            };
            
            if (serverFormData.fname) document.getElementById('first_name').value = serverFormData.fname;
            if (serverFormData.lname) document.getElementById('last_name').value = serverFormData.lname;
            if (serverFormData.email) document.getElementById('email').value = serverFormData.email;
            if (serverFormData.Uname) document.getElementById('username').value = serverFormData.Uname;
            if (serverFormData.age) document.getElementById('age').value = serverFormData.age;
            if (serverFormData.gender) document.getElementById('gender').value = serverFormData.gender;
            if (serverFormData.avatar) {
                const avatarRadio = document.querySelector(`input[name="avatar"][value="${serverFormData.avatar}"]`);
                if (avatarRadio) {
                    avatarRadio.checked = true;
                    // Also update visual selection
                    const avatarOption = avatarRadio.closest('.avatar-option');
                    if (avatarOption) {
                        document.querySelectorAll('.avatar-option').forEach(opt => {
                            opt.classList.remove('selected', 'bg-deep-rose/20');
                            opt.classList.add('bg-warm-gray/30');
                        });
                        avatarOption.classList.add('selected', 'bg-deep-rose/20');
                        avatarOption.classList.remove('bg-warm-gray/30');
                    }
                }
            }
            {% endif %}
            
            // Also restore from sessionStorage as backup (only if server didn't provide data)
            if (!serverFormData || !serverFormData.fname) {
                const savedData = sessionStorage.getItem('signup_form_data');
                if (savedData) {
                    try {
                        const formData = JSON.parse(savedData);
                        if (formData.fname) document.getElementById('first_name').value = formData.fname;
                        if (formData.lname) document.getElementById('last_name').value = formData.lname;
                        if (formData.email) document.getElementById('email').value = formData.email;
                        if (formData.username) document.getElementById('username').value = formData.username;
                        if (formData.age) document.getElementById('age').value = formData.age;
                        if (formData.gender) document.getElementById('gender').value = formData.gender;
                        if (formData.avatar) {
                            const avatarRadio = document.querySelector(`input[name="avatar"][value="${formData.avatar}"]`);
                            if (avatarRadio) {
                                avatarRadio.checked = true;
                                const avatarOption = avatarRadio.closest('.avatar-option');
                                if (avatarOption) {
                                    document.querySelectorAll('.avatar-option').forEach(opt => {
                                        opt.classList.remove('selected', 'bg-deep-rose/20');
                                        opt.classList.add('bg-warm-gray/30');
                                    });
                                    avatarOption.classList.add('selected', 'bg-deep-rose/20');
                                    avatarOption.classList.remove('bg-warm-gray/30');
                                }
                            }
                        }
                    } catch (e) {
                        console.error('Error restoring form data:', e);
                    }
                }
            }
            
            // Update submit button state after restoring data
            if (typeof updateSubmitButtonState === 'function') {
                setTimeout(updateSubmitButtonState, 100);
            }
        }
        
        function clearFormData() {
            sessionStorage.removeItem('signup_form_data');
        }
        
        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Restore form data if available
            restoreFormData();
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                    
                    // Toggle hamburger icon
                    const icon = mobileMenuButton.querySelector('i');
                    if (mobileMenu.classList.contains('hidden')) {
                        icon.className = 'fas fa-bars text-xl';
                    } else {
                        icon.className = 'fas fa-times text-xl';
                    }
                });
            }
            
            // Save form data on input changes
            const formInputs = ['first_name', 'last_name', 'email', 'username', 'age', 'gender'];
            formInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', saveFormData);
                    input.addEventListener('change', saveFormData);
                }
            });
            
            // Save avatar selection
            document.querySelectorAll('input[name="avatar"]').forEach(radio => {
                radio.addEventListener('change', saveFormData);
            });
            
            // Field-level validation functions
            function showFieldError(fieldId, message) {
                const errorDiv = document.getElementById(fieldId + '_error');
                const field = document.getElementById(fieldId);
                if (errorDiv && field) {
                    errorDiv.textContent = message;
                    errorDiv.classList.remove('hidden');
                    field.classList.add('border-red-500');
                    field.classList.remove('border-gray-300');
                }
            }
            
            function clearFieldError(fieldId) {
                const errorDiv = document.getElementById(fieldId + '_error');
                const field = document.getElementById(fieldId);
                if (errorDiv && field) {
                    errorDiv.classList.add('hidden');
                    errorDiv.textContent = '';
                    field.classList.remove('border-red-500');
                    field.classList.add('border-gray-300');
                }
            }
            
            function validateField(fieldId, validator) {
                const field = document.getElementById(fieldId);
                if (!field) return true;
                
                const value = field.value.trim();
                const isValid = validator(value);
                
                if (!isValid) {
                    return false;
                } else {
                    clearFieldError(fieldId);
                    return true;
                }
            }
            
            // Real-time validation
            document.getElementById('first_name')?.addEventListener('blur', function() {
                validateField('first_name', (val) => {
                    if (!val) {
                        showFieldError('first_name', 'First name is required');
                        return false;
                    }
                    if (val.length < 2) {
                        showFieldError('first_name', 'First name must be at least 2 characters');
                        return false;
                    }
                    return true;
                });
            });
            
            document.getElementById('last_name')?.addEventListener('blur', function() {
                validateField('last_name', (val) => {
                    if (!val) {
                        showFieldError('last_name', 'Last name is required');
                        return false;
                    }
                    if (val.length < 2) {
                        showFieldError('last_name', 'Last name must be at least 2 characters');
                        return false;
                    }
                    return true;
                });
            });
            
            document.getElementById('email')?.addEventListener('blur', function() {
                validateField('email', (val) => {
                    if (!val) {
                        showFieldError('email', 'Email is required');
                        return false;
                    }
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(val)) {
                        showFieldError('email', 'Please enter a valid email address');
                        return false;
                    }
                    return true;
                });
            });
            
            document.getElementById('username')?.addEventListener('blur', function() {
                validateField('username', (val) => {
                    if (!val) {
                        showFieldError('username', 'Username is required');
                        return false;
                    }
                    if (val.length < 3) {
                        showFieldError('username', 'Username must be at least 3 characters');
                        return false;
                    }
                    if (!/^[a-zA-Z0-9_]+$/.test(val)) {
                        showFieldError('username', 'Username can only contain letters, numbers, and underscores');
                        return false;
                    }
                    return true;
                });
            });
            
            // Password strength validation
            function validatePasswordStrength(password) {
                if (!password) {
                    return { valid: false, message: 'Password is required' };
                }
                if (password.length < 8) {
                    return { valid: false, message: 'Password must be at least 8 characters long' };
                }
                if (!/[A-Z]/.test(password)) {
                    return { valid: false, message: 'Password must contain at least one uppercase letter' };
                }
                if (!/[a-z]/.test(password)) {
                    return { valid: false, message: 'Password must contain at least one lowercase letter' };
                }
                if (!/[0-9]/.test(password)) {
                    return { valid: false, message: 'Password must contain at least one number' };
                }
                if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
                    return { valid: false, message: 'Password must contain at least one special character (!@#$%^&*(),.?":{}|<>)' };
                }
                return { valid: true, message: '' };
            }
            
            // Real-time password strength indicator
            document.getElementById('password')?.addEventListener('input', function() {
                const password = this.value;
                const strengthDiv = document.getElementById('password_strength');
                
                if (!strengthDiv) return;
                
                if (password.length === 0) {
                    strengthDiv.classList.add('hidden');
                    updateSubmitButtonState();
                    return;
                }
                
                strengthDiv.classList.remove('hidden');
                const strength = validatePasswordStrength(password);
                
                // Update strength indicator
                const requirements = [
                    { test: password.length >= 8, text: 'At least 8 characters' },
                    { test: /[A-Z]/.test(password), text: 'One uppercase letter' },
                    { test: /[a-z]/.test(password), text: 'One lowercase letter' },
                    { test: /[0-9]/.test(password), text: 'One number' },
                    { test: /[!@#$%^&*(),.?":{}|<>]/.test(password), text: 'One special character' }
                ];
                
                let html = '<div class="text-xs mt-2 space-y-1">';
                requirements.forEach(req => {
                    const icon = req.test ? '✓' : '○';
                    const color = req.test ? 'text-green-600' : 'text-gray-400';
                    html += `<div class="${color}">${icon} ${req.text}</div>`;
                });
                html += '</div>';
                strengthDiv.innerHTML = html;
                
                // Update submit button state
                updateSubmitButtonState();
            });
            
            // Function to check if form is valid and update submit button
            function updateSubmitButtonState() {
                const submitBtn = document.getElementById('submitBtn');
                if (!submitBtn) return;
                
                // Check all required fields
                const firstName = document.getElementById('first_name')?.value.trim() || '';
                const lastName = document.getElementById('last_name')?.value.trim() || '';
                const email = document.getElementById('email')?.value.trim() || '';
                const username = document.getElementById('username')?.value.trim() || '';
                const password = document.getElementById('password')?.value || '';
                const confirmPassword = document.getElementById('confirm_password')?.value || '';
                const age = document.getElementById('age')?.value || '';
                const gender = document.getElementById('gender')?.value || '';
                const terms = document.getElementById('terms')?.checked || false;
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const emailValid = emailRegex.test(email);
                
                // Validate username format
                const usernameValid = username.length >= 3 && /^[a-zA-Z0-9_]+$/.test(username);
                
                // Validate password strength
                const passwordValidation = validatePasswordStrength(password);
                const passwordValid = passwordValidation.valid;
                
                // Check password match
                const passwordsMatch = password && confirmPassword && password === confirmPassword;
                
                // Validate age
                const ageNum = parseInt(age);
                const ageValid = !isNaN(ageNum) && ageNum >= 13 && ageNum <= 100;
                
                // Check if all fields are valid
                const isFormValid = firstName.length >= 2 &&
                                  lastName.length >= 2 &&
                                  emailValid &&
                                  usernameValid &&
                                  passwordValid &&
                                  passwordsMatch &&
                                  ageValid &&
                                  gender &&
                                  terms;
                
                // Update button state
                if (isFormValid) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    submitBtn.disabled = true;
                    submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
            
            // Add event listeners to update submit button state
            ['first_name', 'last_name', 'email', 'username', 'password', 'confirm_password', 'age', 'gender', 'terms'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updateSubmitButtonState);
                    field.addEventListener('change', updateSubmitButtonState);
                    field.addEventListener('blur', updateSubmitButtonState);
                }
            });
            
            // Initial state check
            updateSubmitButtonState();
            
            document.getElementById('password')?.addEventListener('blur', function() {
                const validation = validatePasswordStrength(this.value);
                if (!validation.valid) {
                    showFieldError('password', validation.message);
                } else {
                    clearFieldError('password');
                }
            });
            
            document.getElementById('confirm_password')?.addEventListener('blur', function() {
                const password = document.getElementById('password')?.value;
                const confirmPassword = document.getElementById('confirm_password')?.value;
                validateField('confirm_password', (val) => {
                    if (!val) {
                        showFieldError('confirm_password', 'Please confirm your password');
                        return false;
                    }
                    if (val !== password) {
                        showFieldError('confirm_password', 'Passwords do not match');
                        return false;
                    }
                    return true;
                });
            });
            
            document.getElementById('age')?.addEventListener('blur', function() {
                validateField('age', (val) => {
                    if (!val) {
                        showFieldError('age', 'Age is required');
                        return false;
                    }
                    const age = parseInt(val);
                    if (isNaN(age) || age < 13 || age > 100) {
                        showFieldError('age', 'Age must be between 13 and 100');
                        return false;
                    }
                    return true;
                });
            });
            
            document.getElementById('gender')?.addEventListener('change', function() {
                validateField('gender', (val) => {
                    if (!val) {
                        showFieldError('gender', 'Please select your gender');
                        return false;
                    }
                    return true;
                });
            });
            
            // Form validation on submit
            const form = document.querySelector('form');
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirm_password');
            const termsCheckbox = document.getElementById('terms');
            
            if (form) {
                form.addEventListener('submit', function(e) {
                    let isValid = true;
                    
                    // Validate all fields
                    isValid = validateField('first_name', (val) => {
                        if (!val || val.length < 2) {
                            showFieldError('first_name', val ? 'First name must be at least 2 characters' : 'First name is required');
                            return false;
                        }
                        return true;
                    }) && isValid;
                    
                    isValid = validateField('last_name', (val) => {
                        if (!val || val.length < 2) {
                            showFieldError('last_name', val ? 'Last name must be at least 2 characters' : 'Last name is required');
                            return false;
                        }
                        return true;
                    }) && isValid;
                    
                    isValid = validateField('email', (val) => {
                        if (!val) {
                            showFieldError('email', 'Email is required');
                            return false;
                        }
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(val)) {
                            showFieldError('email', 'Please enter a valid email address');
                            return false;
                        }
                        return true;
                    }) && isValid;
                    
                    isValid = validateField('username', (val) => {
                        if (!val || val.length < 3) {
                            showFieldError('username', val ? 'Username must be at least 3 characters' : 'Username is required');
                            return false;
                        }
                        if (!/^[a-zA-Z0-9_]+$/.test(val)) {
                            showFieldError('username', 'Username can only contain letters, numbers, and underscores');
                            return false;
                        }
                        return true;
                    }) && isValid;
                    
                    if (password && confirmPassword) {
                        isValid = validateField('password', (val) => {
                            const validation = validatePasswordStrength(val);
                            if (!validation.valid) {
                                showFieldError('password', validation.message);
                                return false;
                            }
                            return true;
                        }) && isValid;
                        
                        isValid = validateField('confirm_password', (val) => {
                            if (!val) {
                                showFieldError('confirm_password', 'Please confirm your password');
                                return false;
                            }
                            if (val !== password.value) {
                                showFieldError('confirm_password', 'Passwords do not match');
                                return false;
                            }
                            return true;
                        }) && isValid;
                    }
                    
                    isValid = validateField('age', (val) => {
                        if (!val) {
                            showFieldError('age', 'Age is required');
                            return false;
                        }
                        const age = parseInt(val);
                        if (isNaN(age) || age < 13 || age > 100) {
                            showFieldError('age', 'Age must be between 13 and 100');
                            return false;
                        }
                        return true;
                    }) && isValid;
                    
                    isValid = validateField('gender', (val) => {
                        if (!val) {
                            showFieldError('gender', 'Please select your gender');
                            return false;
                        }
                        return true;
                    }) && isValid;
                    
                    // Validate terms checkbox
                    if (termsCheckbox && !termsCheckbox.checked) {
                        showFieldError('terms', 'You must agree to the Terms of Service and Privacy Policy');
                        isValid = false;
                    } else if (termsCheckbox) {
                        clearFieldError('terms');
                    }
                    
                    if (!isValid) {
                        e.preventDefault();
                        // Save form data before showing errors (in case of page reload)
                        saveFormData();
                        // Scroll to first error
                        const firstError = document.querySelector('.error-message:not(.hidden)');
                        if (firstError) {
                            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return false;
                    } else {
                        // Clear saved form data on successful submission
                        clearFormData();
                    }
                });
            }
        });
        
        // Terms of Service and Privacy Policy Modals
        function showTermsModal() {
            document.getElementById('termsModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeTermsModal() {
            document.getElementById('termsModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        function showPrivacyModal() {
            document.getElementById('privacyModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closePrivacyModal() {
            document.getElementById('privacyModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Close modals when clicking outside
        document.getElementById('termsModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeTermsModal();
            }
        });
        
        document.getElementById('privacyModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closePrivacyModal();
            }
        });
        
        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeTermsModal();
                closePrivacyModal();
            }
        });
    </script>
    
    <!-- Terms of Service Modal -->
    <div id="termsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-deep-plum font-poppins">Terms of Service</h2>
                <button onclick="closeTermsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6 text-warm-brown leading-relaxed">
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">1. Acceptance of Terms</h3>
                    <p>By accessing and using Funza Mama, you accept and agree to be bound by the terms and provision of this agreement.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">2. AI Technology Disclosure</h3>
                    <p class="mb-2">Funza Mama uses artificial intelligence (AI) to provide personalized learning experiences and generate educational content. We are transparent about our AI usage:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li><strong>Primary AI Model:</strong> Meta-Llama-3.1-8B-Instruct-Turbo (8 billion parameter language model developed by Meta)</li>
                        <li><strong>Fallback AI Model:</strong> zai-org/GLM-4.7 (alternative model for reliability)</li>
                        <li><strong>AI Platform:</strong> Together AI (cloud-based AI inference platform)</li>
                        <li><strong>Purpose:</strong> AI is used to generate quiz questions, provide educational explanations, and offer personalized learning recommendations</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">3. AI Limitations and Ethical Considerations</h3>
                    <p class="mb-2">While we strive for accuracy, please be aware that:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li>AI-generated content may occasionally contain errors or inaccuracies</li>
                        <li>AI responses are generated based on training data and may not always reflect the most current medical guidelines</li>
                        <li>This platform is for educational purposes only and does not replace professional medical advice</li>
                        <li>Always consult qualified healthcare professionals for medical decisions</li>
                        <li>We continuously monitor and improve AI outputs for accuracy and safety</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">4. Educational Purpose Only</h3>
                    <p>Funza Mama is designed for educational purposes only. The information provided should not be considered as medical advice, diagnosis, or treatment. Always seek the advice of qualified healthcare providers with any questions you may have regarding a medical condition.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">5. User Responsibilities</h3>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li>Provide accurate and truthful information during registration</li>
                        <li>Maintain the confidentiality of your account credentials</li>
                        <li>Use the platform responsibly and in accordance with these terms</li>
                        <li>Not use the platform for any illegal or unauthorized purpose</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">6. Data Processing</h3>
                    <p>By using Funza Mama, you acknowledge that your interactions with the AI system may be processed by Together AI's infrastructure. We take data privacy seriously and handle your information in accordance with our Privacy Policy.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">7. Modifications to Terms</h3>
                    <p>We reserve the right to modify these terms at any time. Continued use of the platform after changes constitutes acceptance of the new terms.</p>
                </div>
            </div>
            
            <div class="mt-8 flex justify-end">
                <button onclick="closeTermsModal()" class="bg-gradient-to-r from-deep-rose to-warm-mauve text-white py-3 px-8 rounded-xl hover:from-warm-mauve hover:to-deep-rose transition-all font-semibold">
                    I Understand
                </button>
            </div>
        </div>
    </div>
    
    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-deep-plum font-poppins">Privacy Policy</h2>
                <button onclick="closePrivacyModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6 text-warm-brown leading-relaxed">
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">1. Information We Collect</h3>
                    <p class="mb-2">We collect the following information:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li><strong>Account Information:</strong> Name, email, username, age, gender</li>
                        <li><strong>Learning Data:</strong> Quiz responses, progress, performance metrics, learning history</li>
                        <li><strong>Usage Data:</strong> Interactions with AI features, time spent on platform, features used</li>
                        <li><strong>Technical Data:</strong> IP address, browser type, device information</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">2. How We Use Your Information</h3>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li>To provide personalized learning experiences</li>
                        <li>To generate AI-powered educational content tailored to your needs</li>
                        <li>To track your progress and provide feedback</li>
                        <li>To improve our AI models and platform functionality</li>
                        <li>To communicate with you about your account and platform updates</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">3. AI Data Processing</h3>
                    <p class="mb-2">When you interact with AI features:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li>Your questions and responses may be processed by Together AI's infrastructure</li>
                        <li>AI models (Meta-Llama-3.1-8B-Instruct-Turbo and GLM-4.7) process your data to generate responses</li>
                        <li>We do not share your personal information with third parties for marketing purposes</li>
                        <li>Together AI processes data in accordance with their privacy policies and security standards</li>
                        <li>We implement measures to minimize data exposure and protect your privacy</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">4. Data Security</h3>
                    <p>We implement industry-standard security measures to protect your data, including encryption, secure authentication, and regular security audits. However, no method of transmission over the internet is 100% secure.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">5. Data Retention</h3>
                    <p>We retain your data for as long as your account is active or as needed to provide services. You can request deletion of your account and associated data at any time.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">6. Your Rights</h3>
                    <p class="mb-2">You have the right to:</p>
                    <ul class="list-disc list-inside ml-4 space-y-2">
                        <li>Access your personal data</li>
                        <li>Correct inaccurate data</li>
                        <li>Request deletion of your data</li>
                        <li>Opt-out of certain data processing activities</li>
                        <li>Export your learning data</li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">7. Third-Party Services</h3>
                    <p>We use Together AI as our AI service provider. Your interactions with AI features are processed through their infrastructure. Please review Together AI's privacy policy for information about their data handling practices.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">8. Children's Privacy</h3>
                    <p>Funza Mama is intended for users aged 13 and above. We do not knowingly collect personal information from children under 13. If you believe we have collected information from a child under 13, please contact us immediately.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">9. Changes to Privacy Policy</h3>
                    <p>We may update this Privacy Policy from time to time. We will notify you of any significant changes by posting the new policy on this page and updating the "Last Updated" date.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-deep-plum mb-3">10. Contact Us</h3>
                    <p>If you have questions about this Privacy Policy or our data practices, please contact us through the platform's feedback system.</p>
                </div>
            </div>
            
            <div class="mt-8 flex justify-end">
                <button onclick="closePrivacyModal()" class="bg-gradient-to-r from-deep-rose to-warm-mauve text-white py-3 px-8 rounded-xl hover:from-warm-mauve hover:to-deep-rose transition-all font-semibold">
                    I Understand
                </button>
            </div>
        </div>
    </div>
</body>
</html>
