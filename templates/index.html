<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funza Mama â€” Learn. Play. Save Lives.</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.jpg') }}" type="image/x-icon"> 
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        'warm-pink': '#F8BBD9',
                        'soft-purple': '#E8C5E8',
                        'deep-rose': '#D17D98',
                        'warm-mauve': '#B19CD9',
                        'soft-cream': '#FFF8F0',
                        'warm-gray': '#F5F5F5',
                        'deep-plum': '#7D1C4A',
                        'warm-brown': '#8B4513',
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #F8BBD9 0%, #E8C5E8 50%, #FFF8F0 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #D17D98 0%, #B19CD9 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #B19CD9 0%, #D17D98 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        /* Interactive Elements */
        .interactive-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .interactive-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Sound Control */
        .sound-toggle {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .sound-toggle {
                right: 15px;
                top: 75px;
                padding: 8px;
            }
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .sound-toggle.muted {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }
        
        /* Particle Effects */
        .particle {
            position: absolute;
            background: rgba(209, 125, 152, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 2s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }
    </style>
</head>
<body class="font-inter gradient-bg min-h-screen">
    <!-- Sound Toggle Button -->
    <button id="soundToggle" onclick="toggleSound()" class="sound-toggle" title="Toggle Sound">
        <i class="fas fa-volume-up text-xl"></i>
            </button>
    
    <!-- Navigation -->
    <nav class="bg-white/90 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <img src="{{ url_for('static', filename='images/favicon.jpg') }}" alt="Funza Mama" class="h-12 w-12 rounded-full object-cover floating-animation">
                    <span class="text-2xl font-bold text-deep-plum font-poppins">Funza Mama</span>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="{{ url_for('gamestages.game') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium">Play Game</a>
                    {% if user_logged_in %}
                    <a href="{{ url_for('profile.view_profile') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium">Profile</a>
                    <a href="{{ url_for('login.logout') }}" class="bg-deep-plum text-white px-6 py-2 rounded-full hover:bg-deep-rose transition-all font-medium">Logout</a>
                    {% else %}
                    <a href="{{ url_for('login.login') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium">Login</a>
                    <a href="{{ url_for('signup.signup') }}" class="bg-deep-plum text-white px-6 py-2 rounded-full hover:bg-deep-rose transition-all font-medium">Sign Up</a>
                    {% endif %}
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-deep-plum hover:text-deep-rose focus:outline-none">
                        <i class="fas fa-bars text-xl"></i>
            </button>
                </div>
            </div>
            
            <!-- Mobile menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t border-gray-200 bg-white/95 backdrop-blur-sm">
                <div class="flex flex-col space-y-4 pt-4">
                    <a href="{{ url_for('gamestages.game') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium px-4 py-2 rounded-lg hover:bg-warm-gray/50">Play Game</a>
                    {% if user_logged_in %}
                    <a href="{{ url_for('profile.view_profile') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium px-4 py-2 rounded-lg hover:bg-warm-gray/50">Profile</a>
                    <a href="{{ url_for('login.logout') }}" class="bg-deep-plum text-white px-6 py-3 rounded-full hover:bg-deep-rose transition-all font-medium text-center mx-4">Logout</a>
                    {% else %}
                    <a href="{{ url_for('login.login') }}" class="text-deep-plum hover:text-deep-rose transition-colors font-medium px-4 py-2 rounded-lg hover:bg-warm-gray/50">Login</a>
                    <a href="{{ url_for('signup.signup') }}" class="bg-deep-plum text-white px-6 py-3 rounded-full hover:bg-deep-rose transition-all font-medium text-center mx-4">Sign Up</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative py-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto text-center">
            <div class="fade-in">
                <h1 class="text-5xl md:text-7xl font-bold text-deep-plum mb-6 font-poppins">
                    Funza Mama
                </h1>
                <p class="text-2xl md:text-3xl text-deep-rose mb-8 font-light">
                    Learn. Play. Save Lives.
                </p>
                <p class="text-lg md:text-xl text-warm-brown mb-12 max-w-3xl mx-auto leading-relaxed">
                    Empowering mothers, fathers, and communities through AI-powered, game-based maternal health education. 
                    Learn to recognize danger signs, make informed decisions, and access reliable health information.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="{{ url_for('gamestages.game') }}" onclick="playClickSound(); createParticles(event)" class="btn-primary text-white px-8 py-4 rounded-full text-lg font-semibold inline-flex items-center justify-center space-x-2 pulse-animation">
                        <i class="fas fa-play"></i>
                        <span>Play Demo</span>
                    </a>
                    <a href="#about" onclick="playClickSound(); createParticles(event)" class="bg-white text-deep-plum px-8 py-4 rounded-full text-lg font-semibold hover:bg-warm-gray transition-all inline-flex items-center justify-center space-x-2">
                        <i class="fas fa-info-circle"></i>
                        <span>Learn More</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- About the Game Section -->
    <section id="about" class="py-20 px-4 sm:px-6 lg:px-8 bg-white/50">
        <div class="max-w-7xl mx-auto">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="fade-in">
                    <h2 class="text-4xl font-bold text-deep-plum mb-6 font-poppins">About the Game</h2>
                    <p class="text-lg text-warm-brown mb-6 leading-relaxed">
                        Funza Mama transforms maternal health education into an engaging, interactive experience. 
                        Through storytelling and simulation-based gameplay, players learn to recognize danger signs 
                        during pregnancy and childbirth while making informed decisions in realistic scenarios.
                    </p>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-heart text-deep-rose text-xl mt-1"></i>
                            <p class="text-warm-brown">Interactive scenarios based on real maternal health challenges</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-graduation-cap text-deep-rose text-xl mt-1"></i>
                            <p class="text-warm-brown">Culturally relevant guidance and community-focused learning</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-users text-deep-rose text-xl mt-1"></i>
                            <p class="text-warm-brown">Designed for mothers, fathers, and community members</p>
                        </div>
                    </div>
                </div>
                <div class="fade-in">
                    <img src="{{ url_for('static', filename='images/mama.jpg') }}" alt="Maternal Health Education" class="rounded-2xl shadow-2xl w-full h-96 object-cover">
                </div>
            </div>
    </div>
    </section>

    <!-- Powered by AI Section -->
    <section class="py-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="fade-in order-2 md:order-1">
                    <img src="{{ url_for('static', filename='images/favicon.jpg') }}" alt="AI Technology" class="rounded-2xl shadow-2xl w-full h-96 object-cover">
                </div>
                <div class="fade-in order-1 md:order-2">
                    <h2 class="text-4xl font-bold text-deep-plum mb-6 font-poppins">Powered by AI (LLaMA)</h2>
                    <p class="text-lg text-warm-brown mb-6 leading-relaxed">
                        Our platform leverages cutting-edge LLaMA AI technology to provide personalized conversations, 
                        adaptive learning experiences, and culturally relevant guidance that makes health education 
                        accessible and engaging for everyone.
                    </p>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-brain text-deep-rose text-xl mt-1"></i>
                            <p class="text-warm-brown">Personalized learning paths based on individual needs</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-comments text-deep-rose text-xl mt-1"></i>
                            <p class="text-warm-brown">Intelligent chatbot for instant health guidance</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-chart-line text-deep-rose text-xl mt-1"></i>
                            <p class="text-warm-brown">Adaptive difficulty that grows with your knowledge</p>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    </section>

    <!-- Why It Matters Section -->
    <section class="py-20 px-4 sm:px-6 lg:px-8 bg-white/50">
        <div class="max-w-7xl mx-auto text-center">
            <div class="fade-in">
                <h2 class="text-4xl font-bold text-deep-plum mb-6 font-poppins">Why It Matters</h2>
                <p class="text-xl text-warm-brown mb-12 max-w-4xl mx-auto leading-relaxed">
                    Maternal and neonatal health education saves lives. By making this knowledge accessible, 
                    engaging, and culturally relevant, we're building stronger, healthier communities.
                </p>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="interactive-card bg-white p-8 rounded-2xl shadow-lg" onclick="playClickSound(); createParticles(event)">
                        <div class="text-4xl text-deep-rose mb-4 pulse-animation">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-deep-plum mb-4">Prevent Complications</h3>
                        <p class="text-warm-brown">Early recognition of danger signs can prevent life-threatening complications during pregnancy and childbirth.</p>
                    </div>
                    <div class="interactive-card bg-white p-8 rounded-2xl shadow-lg" onclick="playClickSound(); createParticles(event)">
                        <div class="text-4xl text-deep-rose mb-4 pulse-animation">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-deep-plum mb-4">Empower Families</h3>
                        <p class="text-warm-brown">Knowledge empowers families to make informed decisions and advocate for better maternal and child health.</p>
                    </div>
                    <div class="interactive-card bg-white p-8 rounded-2xl shadow-lg" onclick="playClickSound(); createParticles(event)">
                        <div class="text-4xl text-deep-rose mb-4 pulse-animation">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-deep-plum mb-4">Build Communities</h3>
                        <p class="text-warm-brown">Strong communities with health knowledge create supportive environments for mothers and children.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Get Involved Section -->
    <section class="py-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto text-center">
            <div class="fade-in">
                <h2 class="text-4xl font-bold text-deep-plum mb-6 font-poppins">Join the Journey</h2>
                <p class="text-xl text-warm-brown mb-12 leading-relaxed">
                    Ready to make a difference? Start your learning journey today and become part of a community 
                    dedicated to improving maternal and child health through education and empowerment.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="{{ url_for('signup.signup') }}" onclick="playClickSound(); createParticles(event)" class="btn-primary text-white px-8 py-4 rounded-full text-lg font-semibold inline-flex items-center justify-center space-x-2 pulse-animation">
                        <i class="fas fa-user-plus"></i>
                        <span>Sign Up Now</span>
                    </a>
                    <a href="{{ url_for('gamestages.game') }}" onclick="playClickSound(); createParticles(event)" class="bg-white text-deep-plum px-8 py-4 rounded-full text-lg font-semibold hover:bg-warm-gray transition-all inline-flex items-center justify-center space-x-2 border-2 border-deep-plum">
                        <i class="fas fa-play"></i>
                        <span>Try Demo</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Chatbot Section -->
    <div class="fixed bottom-6 right-6 z-50">
        <button onclick="toggleChat()" class="bg-deep-plum text-white p-4 rounded-full shadow-lg hover:bg-deep-rose transition-all transform hover:scale-110">
            <i class="fas fa-comments text-xl"></i>
        </button>

            <!-- Chatbot Popup -->
        <div id="chatbot" class="hidden absolute bottom-16 right-0 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200">
            <div class="bg-deep-plum text-white p-4 rounded-t-2xl flex justify-between items-center">
                <span class="font-semibold">Ask Funza Mama</span>
                <button onclick="toggleChat()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="chatbot-body" class="p-4 h-64 overflow-y-auto">
                <div class="bg-warm-gray p-3 rounded-lg mb-3">
                    <p class="text-sm text-warm-brown">Hi there! I'm Funza Mama, your AI health companion. How can I help you today?</p>
                </div>
                </div>
            <div class="p-4 border-t border-gray-200 flex space-x-2">
                <input type="text" id="user_input" placeholder="Type your message..." class="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-deep-rose">
                <button onclick="sendMessage()" class="bg-deep-plum text-white px-4 py-2 rounded-lg hover:bg-deep-rose transition-colors">
                    <i class="fas fa-paper-plane"></i>
                </button>
                </div>
                </div>
            </div>
        
    <!-- Footer -->
    <footer class="bg-deep-plum text-white py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto text-center">
            <div class="fade-in">
                <h3 class="text-2xl font-bold mb-4 font-poppins">Funza Mama</h3>
                <p class="text-lg mb-6 text-warm-pink">
                    Empowering families through knowledge and play.
                </p>
                <div class="flex justify-center space-x-6 mb-8">
                    <a href="#" class="text-warm-pink hover:text-white transition-colors">
                        <i class="fab fa-facebook text-xl"></i>
                    </a>
                    <a href="#" class="text-warm-pink hover:text-white transition-colors">
                        <i class="fab fa-twitter text-xl"></i>
                    </a>
                    <a href="#" class="text-warm-pink hover:text-white transition-colors">
                        <i class="fab fa-instagram text-xl"></i>
                    </a>
                    <a href="#" class="text-warm-pink hover:text-white transition-colors">
                        <i class="fab fa-linkedin text-xl"></i>
                    </a>
                </div>
                <p class="text-sm text-warm-pink">
                    Â© 2025 Funza Mama. All rights reserved. | "Funza Mama" means "Teach the Mother" in Swahili.
                </p>
            </div>
    </div>
    </footer>

    <script>
        // Sound System
        let soundEnabled = true;
        let audioContext = null;
        
        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Play sound function
        function playSound(frequency, duration, type = 'sine') {
            if (!soundEnabled) return;
            
            initAudio();
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playClickSound() {
            playSound(800, 0.1, 'square');
        }
        
        function playHoverSound() {
            playSound(600, 0.05, 'sine');
        }
        
        // Vibration
        function vibrate(pattern = [50]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }
        
        // Sound toggle
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const toggle = document.getElementById('soundToggle');
            const icon = toggle.querySelector('i');
            
            if (soundEnabled) {
                toggle.classList.remove('muted');
                icon.className = 'fas fa-volume-up text-xl';
                playClickSound();
            } else {
                toggle.classList.add('muted');
                icon.className = 'fas fa-volume-mute text-xl';
            }
        }
        
        // Particle Effects
        function createParticles(event) {
            const rect = event.target.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                particle.style.width = Math.random() * 6 + 4 + 'px';
                particle.style.height = particle.style.width;
                
                const angle = (Math.PI * 2 * i) / 8;
                const velocity = 50 + Math.random() * 50;
                const x = Math.cos(angle) * velocity;
                const y = Math.sin(angle) * velocity;
                
                particle.style.setProperty('--x', x + 'px');
                particle.style.setProperty('--y', y + 'px');
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }
        
        // Interactive hover effects
        function addHoverEffects() {
            const interactiveElements = document.querySelectorAll('.interactive-card, .btn-primary, a[onclick*="playClickSound"]');
            
            interactiveElements.forEach(element => {
                element.addEventListener('mouseenter', () => {
                    playHoverSound();
                    vibrate([30]);
                });
            });
        }
        
        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                    
                    // Toggle hamburger icon
                    const icon = mobileMenuButton.querySelector('i');
                    if (mobileMenu.classList.contains('hidden')) {
                        icon.className = 'fas fa-bars text-xl';
                    } else {
                        icon.className = 'fas fa-times text-xl';
                    }
                });
            }
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Fade in animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        document.querySelectorAll('section').forEach(section => {
            observer.observe(section);
        });
        
        // Initialize interactive effects
        addHoverEffects();

        // Chatbot functionality
        function toggleChat() {
      const chatBox = document.getElementById("chatbot");
            chatBox.classList.toggle("hidden");
    }

    function getOfflineChatbotResponse(message) {
    const messageLower = message.toLowerCase();
    
    // Simple keyword-based responses
    if (messageLower.includes('pregnancy') || messageLower.includes('pregnant') || messageLower.includes('prenatal')) {
        return "I'm here to help with pregnancy questions! During pregnancy, it's important to maintain regular prenatal care, eat a balanced diet, and stay active with your healthcare provider's approval. Is there something specific about pregnancy you'd like to know more about?";
    } else if (messageLower.includes('birth') || messageLower.includes('labor') || messageLower.includes('delivery') || messageLower.includes('contractions')) {
        return "I can help with birth and delivery questions! Signs of labor include regular contractions, water breaking, and cervical dilation. It's important to contact your healthcare provider when you think labor has started. Do you have specific questions about the birthing process?";
    } else if (messageLower.includes('baby') || messageLower.includes('newborn') || messageLower.includes('postnatal') || messageLower.includes('postpartum')) {
        return "I'm here to help with newborn and postnatal care questions! Newborns need frequent feeding, proper sleep positioning (on their back), and regular check-ups. Postpartum care for mothers includes rest, proper nutrition, and emotional support. What specific aspect of newborn or postnatal care would you like to know about?";
    } else if (messageLower.includes('nutrition') || messageLower.includes('diet') || messageLower.includes('food') || messageLower.includes('eating')) {
        return "Nutrition is crucial for maternal health! During pregnancy, focus on a balanced diet with folic acid, iron, calcium, and protein. Avoid raw fish, unpasteurized foods, and excessive caffeine. Are you looking for specific nutritional advice for a particular stage?";
    } else if (messageLower.includes('exercise') || messageLower.includes('activity') || messageLower.includes('fitness') || messageLower.includes('workout')) {
        return "Exercise during pregnancy can be beneficial with your healthcare provider's approval! Low-impact activities like walking, swimming, and prenatal yoga are generally safe. Always consult your healthcare provider before starting any exercise routine during pregnancy.";
    } else {
        return `Thank you for your question: "${message}". I'm Funza Mama, your AI assistant for maternal health education. I can help with questions about pregnancy, childbirth, newborn care, nutrition, exercise, and more. What specific maternal health topic would you like to learn about?`;
    }
}

async function sendMessage() {
            const userInputField = document.getElementById("user_input");
            const userInput = userInputField.value.trim();
            const chatBody = document.getElementById("chatbot-body");

            if (!userInput) return;

            // Add user message
            const userMessage = document.createElement("div");
            userMessage.className = "bg-deep-plum text-white p-3 rounded-lg mb-3 ml-8";
            userMessage.innerHTML = `<p class="text-sm">${userInput}</p>`;
    chatBody.appendChild(userMessage);

            // Clear input and disable
    userInputField.value = "";
    userInputField.disabled = true;

            // Scroll to bottom
    chatBody.scrollTop = chatBody.scrollHeight;

    try {
        console.log("Sending message to chatbot:", userInput);
        
        // Try main chatbot endpoint with hybrid AI service
        const response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                "message": userInput,
                "use_hybrid": true  // Enable hybrid AI service
            })
        });

        console.log("Response status:", response.status);
        console.log("Response headers:", response.headers);

        if (!response.ok) {
            if (response.status === 0) {
                throw new Error("Network error: Unable to connect to server. Please check if the Flask app is running.");
            } else if (response.status === 404) {
                throw new Error("Server error: Chatbot endpoint not found. Please check the server configuration.");
            } else if (response.status === 500) {
                throw new Error("Server error: Internal server error. Please try again later.");
            } else {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
        }

        const responseText = await response.text();
        console.log("Raw response:", responseText);
        
        let data;
        try {
            data = JSON.parse(responseText);
        } catch (parseError) {
            console.error("JSON parse error:", parseError);
            console.error("Response text that failed to parse:", responseText);
            throw new Error("Invalid response format from server. Server may not be running properly.");
        }

        // Add bot response
        const botMessage = document.createElement("div");
        botMessage.className = "bg-warm-gray p-3 rounded-lg mb-3";
        
        // Check if this is a fallback response (indicates rate limiting)
        const isFallbackResponse = data.response && (
            data.response.includes("high demand") || 
            data.response.includes("rate limit") ||
            data.response.includes("basic maternal health questions")
        );
        
        if (isFallbackResponse) {
            botMessage.innerHTML = `
                <p class="text-sm text-warm-brown">${data.response}</p>
                <p class="text-xs text-warm-brown mt-2 opacity-75">
                    <i class="fas fa-info-circle mr-1"></i>
                    Using simplified responses due to high demand
                </p>
            `;
        } else {
            botMessage.innerHTML = `<p class="text-sm text-warm-brown">${data.response || "Sorry, I couldn't process your request."}</p>`;
        }
        
        chatBody.appendChild(botMessage);

    } catch (error) {
        console.error("Chatbot error:", error);
        
        // Try offline fallback chatbot
        try {
            const fallbackResponse = getOfflineChatbotResponse(userInput);
            const botMessage = document.createElement("div");
            botMessage.className = "bg-warm-gray p-3 rounded-lg mb-3";
            botMessage.innerHTML = `<p class="text-sm text-warm-brown">${fallbackResponse}</p>`;
            chatBody.appendChild(botMessage);
        } catch (fallbackError) {
            console.error("Fallback chatbot also failed:", fallbackError);
            const errorMessage = document.createElement("div");
            errorMessage.className = "bg-red-100 text-red-800 p-3 rounded-lg mb-3";
            errorMessage.innerHTML = `<p class="text-sm">Sorry, I'm having trouble connecting. Please try again later.</p>`;
            chatBody.appendChild(errorMessage);
        }
    }

            // Re-enable input
    userInputField.disabled = false;
    userInputField.focus();
    chatBody.scrollTop = chatBody.scrollHeight;
}

        // Allow Enter key to send message
        document.getElementById("user_input").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                sendMessage();
            }
        });
    </script>
</body>
</html>
